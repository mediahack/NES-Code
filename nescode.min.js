/**
* @name     NESCode jsApp - nescode.js
* @project  NESCode
* @author <codes>      mediaHACK - http://mediahack.com
* @date         2013.12.15
* @version      131215
*
* @licence  New BSD License.
* @licence  Creative-Commons BY
* 
* This jsApp will embed NES style cheat code into your pages.
*
**/
function NESCode(a){this.scriptHost="https://github.com/mediahack/NES-Code/",this.settings=a,this.debug=!1,this.input="",this.selectKey=16,this.startKey=13,this.cheats={contra:{code:[38,38,40,40,37,39,37,39,66,65,16,13],callback:"_30lives"}},this.customCheats=null,this.snifferSpeed=250,this.timeout=null,this.timer=3e3,NESCode.currentIndex=NESCode.currentIndex||0,this.index=NESCode.currentIndex++,this.init=function(){var a=this;a.config(),document.addEventListener?document.addEventListener("keyup",function(b){a.keyUp(b)},!1):document.attachEvent&&document.attachEvent("onkeyup",function(b){a.keyUp(b)}),setInterval(function(){a.codeSniffer()},a.snifferSpeed)},this.config=function(){if(null!=this.settings)for(var a in this.settings)this[a]=this.settings[a];if(null!=this.customCheats&&"object"==typeof this.customCheats)for(var a in this.customCheats)if(void 0!=this.cheats[a])for(var b in this.customCheats[a])this.cheats[a][b]=this.customCheats[a][b];else this.cheats[a]=this.customCheats[a]},this.codeSniffer=function(){var a=this;for(var b in a.cheats){var c=a.input,d=a.cheats[b].code.join(""),e=a.cheats[b].callback||a.myCheat,f=RegExp(d);f.test(c)&&c.length>0&&c.length>=d.length&&(a.debug&&console.log("found "+b),a.resetInputBuffer(),"function"==typeof window[e]?window[e]():"function"==typeof e?e():"function"==typeof this[e]?this[e]():void 0==e&&(console&&a.debug?console.log("erm, you didn't specify a cheat to perform on this code!"):console&&a.debug&&console.log("I don't know how to use this cheat!")))}},this.resetInputBuffer=function(){this.debug&&console.log("clearing input array"),this.input=""},this.keyUp=function(a){var b=this;b.input+=a.keyCode,b.debug&&console.log(a.keyCode),b.debug&&console.log("current input: "+b.input),null!=b.timeout&&clearTimeout(b.timeout),b.timeout=setTimeout(function(){b.resetInputBuffer()},b.timer)},this.myCheat=function(){var a="ULTIMATE POWER!";console&&void 0!=console?console.log(a):alert(a)},this._30lives=function(){document.getElementsByTagName("body")[0];var c=document.getElementById("_30lives")||document.createElement("audio"),d=document.getElementById("_30lives_src1")||document.createElement("source");d.id="_30lives_src1",d.src="audio/Contra_G_Probotector_StageComplete.ogg",d.type='audio/mpeg; codecs="mp3"';var e=document.getElementById("_30lives_src2")||document.createElement("source");e.id="_30lives_src2",e.src="https://github.com/mediahack/NES-Code/blob/development/example/audio/Contra_G_Probotector_StageComplete.ogg?raw=true",e.type='audio/ogg; codecs="vorbis"',c.appendChild(e),c.appendChild(d);var f=document.getElementById("_30lives_emb")||document.createElement("embed");f.width=100,f.height=50,f.src="https://github.com/mediahack/NES-Code/blob/development/example/audio/Contra_G_Probotector_StageComplete.mp3?raw=true",c.appendChild(f),c.id="_30lives",c.autostart=!0,c.preload="auto",c.hidden=!0,c.oncanplay=function(){this.play()},document.getElementsByTagName("body")[0].appendChild(c)},this.init()}
